
<!-- README.md is generated from README.Rmd. Please edit that file -->

# czb-util

A collection of scripts for common data management and processing tasks.

The provided pipelines are built using the [Viash
framework](http://www.viash.io) on top of the Nextflow workflow system.
For more information on Nextflow please visit the [Nextflow github
page](https://github.com/nextflow-io/nextflow) and the [Nextflow read
the docs page](https://www.nextflow.io/docs/latest/index.html).

## Requirements

-   Install `Docker`, `Podman` or `Singularity`.
-   Install `Nextflow`.

### Running Cell Ranger Demux

``` sh
nextflow \
  run https://github.com/czbiohub/utilities \
  -r 1.0.0 \
  -main-script workflows/demux_cellranger/main.nf \
  -resume \
  -latest \
  -with-docker \
  --id tiny_bcl \
  --input resources_test/cellranger_tiny_bcl/bcl \
  --sample_sheet resources_test/cellranger_tiny_bcl/bcl/sample_sheet.csv \
  --publishDir temp
```

### Running Cell Ranger Mapping

``` sh
bin/nextflow \
  run https://github.com/czbiohub/utilities \
  -r 1.0.0 \
  -main-script workflows/mapping_cellranger/main.nf \
  -resume \
  -latest \
  -with-docker \
  --id tiny_fastq \
  --input resources_test/cellranger_tiny_fastq/cellranger_tiny_fastq \
  --reference resources_test/cellranger_tiny_fastq/cellranger_tiny_ref \
  --publishDir temp
```

## Setting up development environment

Run `bin/init` to set up Viash and Nextflow.

Run `bin/viash_build` to build all components and Docker containers
locally.

Run `bin/viash_test` to unit test all components.

Run any of the following scripts to integration test individual
pipelines:

-   `workflows/demux_cellranger/test/integration_test.sh`
-   `workflows/mapping_cellranger/test/integration_test.sh`

## List of components

The results below were generated by running
`bin/viash_build; bin/viash_test`.

| Namespace    | Component                                                                    | Tests                                                                     | Maintainer                              | Duration (s) |
|:-------------|:-----------------------------------------------------------------------------|:--------------------------------------------------------------------------|:----------------------------------------|-------------:|
| alignment    | [cellranger_count](src/alignment/cellranger_count/config.vsh.yaml)           | ![tests](https://img.shields.io/badge/tests-1%20out%20of%201-brightgreen) |                                         |           77 |
| alignment    | [spaceranger_count](src/alignment/spaceranger_count/config.vsh.yaml)         | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| combine      | [combine_tables](src/combine/combine_tables/config.vsh.yaml)                 | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| convert      | [convert_10x_h5_to_h5ad](src/convert/convert_10x_h5_to_h5ad/config.vsh.yaml) | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| convert      | [convert_10x_h5_to_h5mu](src/convert/convert_10x_h5_to_h5mu/config.vsh.yaml) | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| convert      | [split_10x_dir](NA)                                                          | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| demux        | [bcl2fastq](src/demux/bcl2fastq/config.vsh.yaml)                             | ![tests](https://img.shields.io/badge/tests-0%20out%20of%201-red)         |                                         |            6 |
| demux        | [cellranger_mkfastq](src/demux/cellranger_mkfastq/config.vsh.yaml)           | ![tests](https://img.shields.io/badge/tests-1%20out%20of%201-brightgreen) |                                         |           11 |
| demux        | [spaceranger_mkfastq](src/demux/spaceranger_mkfastq/config.vsh.yaml)         | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| download     | [download_basespace](src/download/download_basespace/config.vsh.yaml)        | ![tests](https://img.shields.io/badge/tests-1%20out%20of%201-brightgreen) | [rcannood](https://github.com/rcannood) |          158 |
| download     | [download_file](src/download/download_file/config.vsh.yaml)                  | ![tests](https://img.shields.io/badge/tests-1%20out%20of%201-brightgreen) | [rcannood](https://github.com/rcannood) |            4 |
| download     | [sync_resources_test](src/download/sync_resources_test/config.vsh.yaml)      | ![tests](https://img.shields.io/badge/tests-1%20out%20of%201-brightgreen) | [rcannood](https://github.com/rcannood) |           17 |
| multiomics   | [cellranger_arc_aggr](src/multiomics/cellranger_arc_aggr/config.vsh.yaml)    | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| multiomics   | [cellranger_arc_count](src/multiomics/cellranger_arc_count/config.vsh.yaml)  | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| multiomics   | [cellranger_cite_seq](src/multiomics/cellranger_cite_seq/config.vsh.yaml)    | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| qc           | [check_samplesheet](src/qc/check_samplesheet/config.vsh.yaml)                | ![tests](https://img.shields.io/badge/tests-0%20out%20of%201-red)         |                                         |            5 |
| rna_velocity | [kb_python](src/rna_velocity/kb_python/config.vsh.yaml)                      | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| rna_velocity | [loompy](src/rna_velocity/loompy/config.vsh.yaml)                            | ![tests](https://img.shields.io/badge/tests-no%20tests-orange)            |                                         |            0 |
| transfer     | [publish](src/publish/config.vsh.yaml)                                       | ![tests](https://img.shields.io/badge/tests-1%20out%20of%201-brightgreen) | Toni Verbeiren                          |            4 |
