#!/bin/bash

# Check Java installed
if ! command -v java --version &> /dev/null
then
    echo "Please ensure Java Runtime â‰¥8 is installed. You can find an open source installer here: https://adoptopenjdk.net/?variant=openjdk8&jvmVariant=hotspot"
    exit
fi

# Check Docker installed
if ! command -v docker --version &> /dev/null
then
    echo "Please ensure Docker is installed and up-to-date. Instructions at https://www.docker.com/get-started"
    exit
fi

# get the root of the directory
REPO_ROOT=$(git rev-parse --show-toplevel)

# ensure that the command below is run from the root of the repository
cd "$REPO_ROOT"

curl -fsSL get.viash.io | bash

# download additional Nxf workflow files
[[ -d src/wf_utils ]] || mkdir -p src/wf_utils
bin/viash export resource platforms/nextflow/ProfilesHelper.config > src/wf_utils/ProfilesHelper.config
bin/viash export resource platforms/nextflow/WorkflowHelper.nf > src/wf_utils/WorkflowHelper.nf
bin/viash export resource platforms/nextflow/DataflowHelper.nf > src/wf_utils/DataflowHelper.nf
 
cd bin

curl -s https://get.nextflow.io | bash